package api

import (
	// standard
	"encoding/json"
	"fmt"
)

func (self *Client) GetMalware(ioctype string, target string) ([]MalwareData, error) {
	retval := []MalwareData{}
	notdone := true
	page := 0

	for ; notdone; page++ {
		var data Malware
		body, err := get_indicator_data(self.key, ioctype, target, fmt.Sprintf("malware?page=%d", page))
		if err != nil {
			return []MalwareData{}, err
		}
		json.Unmarshal(body, &data)

		if data.Next == "" {
			notdone = false
		}

		for _, nd := range data.Data {
			retval = append(retval, nd)
		}
	}
	return retval, nil

}
